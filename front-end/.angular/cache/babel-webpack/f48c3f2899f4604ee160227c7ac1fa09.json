{"ast":null,"code":"import _asyncToGenerator from \"E:/Formation/Laboratoire/Angular/Angular/front-end/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../_services/auth.service\";\nimport * as i2 from \"@angular/common\";\n\nfunction HomeComponent_h2_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\"\", ctx_r0.welcomer, \" \", ctx_r0.prenom, \" \", ctx_r0.nom, \"\");\n  }\n}\n\nfunction HomeComponent_h2_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r1.welcomer);\n  }\n}\n\nexport class HomeComponent {\n  constructor(authService) {\n    this.authService = authService;\n    this.welcomer = \"Bienvenue sur AirB&B\";\n    this.nom = \"\";\n    this.prenom = \"\";\n  }\n\n  ngOnInit() {\n    if (this.authService.getUser() !== null) {\n      this.prenom = JSON.parse(this.authService.getUser()).Prenom;\n      this.nom = JSON.parse(this.authService.getUser()).Nom;\n    }\n  }\n\n  loginTest() {\n    const instance = axios.create({\n      baseURL: 'http://localhost:5400/'\n    });\n    console.log('trying to login');\n    let refreshToken;\n    instance.post('/login', {\n      email: 'van.bellinghen.brian@gmail.com',\n      password: 'tamerfdp'\n    }).then(response => {\n      console.log('auth success');\n      instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\n      refreshToken = response.data.refreshToken;\n      loadUserInfos();\n    }).catch(err => {\n      console.log(err.response.status);\n    });\n\n    function loadUserInfos() {\n      instance.get('/me').then(response => {\n        console.log(response.data);\n      }).catch(err => {\n        console.log(err.response.status);\n      });\n    }\n\n    instance.interceptors.response.use(response => {\n      return response;\n    }, /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (error) {\n        const originalRequest = error.config;\n\n        if (error.config.url != '/refreshToken' && error.response.status === 401 && originalRequest._retry !== true) {\n          originalRequest._retry = true;\n\n          if (refreshToken && refreshToken != '') {\n            instance.defaults.headers.common['authorization'] = `Bearer ${refreshToken}`;\n            console.log('refresh token');\n            yield instance.post('/refreshToken').then(response => {\n              instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\n              originalRequest.headers['authorization'] = `Bearer ${response.data.accessToken}`;\n            }).catch(error => {\n              console.log(error.response.status);\n              refreshToken = null;\n            });\n            return instance(originalRequest);\n          }\n        }\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n}\n\nHomeComponent.ɵfac = function HomeComponent_Factory(t) {\n  return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.AuthService));\n};\n\nHomeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: HomeComponent,\n  selectors: [[\"app-home\"]],\n  decls: 5,\n  vars: 2,\n  consts: [[4, \"ngIf\"], [3, \"click\"]],\n  template: function HomeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, HomeComponent_h2_0_Template, 2, 3, \"h2\", 0);\n      i0.ɵɵtemplate(1, HomeComponent_h2_1_Template, 2, 1, \"h2\", 0);\n      i0.ɵɵelement(2, \"br\");\n      i0.ɵɵelementStart(3, \"button\", 1);\n      i0.ɵɵlistener(\"click\", function HomeComponent_Template_button_click_3_listener() {\n        return ctx.loginTest();\n      });\n      i0.ɵɵtext(4, \"TEST\");\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.prenom.length > 0 && ctx.nom.length > 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.prenom.length === 0 && ctx.nom.length === 0);\n    }\n  },\n  directives: [i2.NgIf],\n  styles: [\"h2[_ngcontent-%COMP%] {\\n  text-align: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxrQkFBQTtBQUNKIiwiZmlsZSI6ImhvbWUuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJoMiB7XHJcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbn0iXX0= */\"]\n});","map":{"version":3,"sources":["E:/Formation/Laboratoire/Angular/Angular/front-end/src/app/home/home.component.ts"],"names":["i0","i1","i2","HomeComponent_h2_0_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ctx_r0","ɵɵnextContext","ɵɵadvance","ɵɵtextInterpolate3","welcomer","prenom","nom","HomeComponent_h2_1_Template","ctx_r1","ɵɵtextInterpolate","HomeComponent","constructor","authService","ngOnInit","getUser","JSON","parse","Prenom","Nom","loginTest","instance","axios","create","baseURL","console","log","refreshToken","post","email","password","then","response","defaults","headers","common","data","accessToken","loadUserInfos","catch","err","status","get","interceptors","use","error","originalRequest","config","url","_retry","ɵfac","HomeComponent_Factory","t","ɵɵdirectiveInject","AuthService","ɵcmp","ɵɵdefineComponent","type","selectors","decls","vars","consts","template","HomeComponent_Template","ɵɵtemplate","ɵɵelement","ɵɵlistener","HomeComponent_Template_button_click_3_listener","ɵɵproperty","length","directives","NgIf","styles"],"mappings":"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","sourcesContent":["import * as i0 from \"@angular/core\";\r\nimport * as i1 from \"../_services/auth.service\";\r\nimport * as i2 from \"@angular/common\";\r\nfunction HomeComponent_h2_0_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"h2\");\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate3(\"\", ctx_r0.welcomer, \" \", ctx_r0.prenom, \" \", ctx_r0.nom, \"\");\r\n} }\r\nfunction HomeComponent_h2_1_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"h2\");\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r1 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate(ctx_r1.welcomer);\r\n} }\r\nexport class HomeComponent {\r\n    constructor(authService) {\r\n        this.authService = authService;\r\n        this.welcomer = \"Bienvenue sur AirB&B\";\r\n        this.nom = \"\";\r\n        this.prenom = \"\";\r\n    }\r\n    ngOnInit() {\r\n        if (this.authService.getUser() !== null) {\r\n            this.prenom = JSON.parse(this.authService.getUser()).Prenom;\r\n            this.nom = JSON.parse(this.authService.getUser()).Nom;\r\n        }\r\n    }\r\n    loginTest() {\r\n        const instance = axios.create({\r\n            baseURL: 'http://localhost:5400/',\r\n        });\r\n        console.log('trying to login');\r\n        let refreshToken;\r\n        instance.post('/login', {\r\n            email: 'van.bellinghen.brian@gmail.com',\r\n            password: 'tamerfdp'\r\n        }).then((response) => {\r\n            console.log('auth success');\r\n            instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\r\n            refreshToken = response.data.refreshToken;\r\n            loadUserInfos();\r\n        }).catch((err) => {\r\n            console.log(err.response.status);\r\n        });\r\n        function loadUserInfos() {\r\n            instance.get('/me').then((response) => {\r\n                console.log(response.data);\r\n            }).catch((err) => {\r\n                console.log(err.response.status);\r\n            });\r\n        }\r\n        instance.interceptors.response.use((response) => {\r\n            return response;\r\n        }, async (error) => {\r\n            const originalRequest = error.config;\r\n            if (error.config.url != '/refreshToken' && error.response.status === 401 && originalRequest._retry !== true) {\r\n                originalRequest._retry = true;\r\n                if (refreshToken && refreshToken != '') {\r\n                    instance.defaults.headers.common['authorization'] = `Bearer ${refreshToken}`;\r\n                    console.log('refresh token');\r\n                    await instance.post('/refreshToken').then((response) => {\r\n                        instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\r\n                        originalRequest.headers['authorization'] = `Bearer ${response.data.accessToken}`;\r\n                    }).catch((error) => {\r\n                        console.log(error.response.status);\r\n                        refreshToken = null;\r\n                    });\r\n                    return instance(originalRequest);\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\nHomeComponent.ɵfac = function HomeComponent_Factory(t) { return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.AuthService)); };\r\nHomeComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: HomeComponent, selectors: [[\"app-home\"]], decls: 5, vars: 2, consts: [[4, \"ngIf\"], [3, \"click\"]], template: function HomeComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, HomeComponent_h2_0_Template, 2, 3, \"h2\", 0);\r\n        i0.ɵɵtemplate(1, HomeComponent_h2_1_Template, 2, 1, \"h2\", 0);\r\n        i0.ɵɵelement(2, \"br\");\r\n        i0.ɵɵelementStart(3, \"button\", 1);\r\n        i0.ɵɵlistener(\"click\", function HomeComponent_Template_button_click_3_listener() { return ctx.loginTest(); });\r\n        i0.ɵɵtext(4, \"TEST\");\r\n        i0.ɵɵelementEnd();\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", ctx.prenom.length > 0 && ctx.nom.length > 0);\r\n        i0.ɵɵadvance(1);\r\n        i0.ɵɵproperty(\"ngIf\", ctx.prenom.length === 0 && ctx.nom.length === 0);\r\n    } }, directives: [i2.NgIf], styles: [\"h2[_ngcontent-%COMP%] {\\n  text-align: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxrQkFBQTtBQUNKIiwiZmlsZSI6ImhvbWUuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJoMiB7XHJcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbn0iXX0= */\"] });\r\n"]},"metadata":{},"sourceType":"module"}